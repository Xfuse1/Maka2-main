<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Supabase Connection</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: 'Cairo', Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            direction: rtl;
        }
        .test-section {
            background: #f5f5f5;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .success { color: green; }
        .error { color: red; }
        button {
            background: #760614;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #a13030;
        }
        pre {
            background: white;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            direction: ltr;
            text-align: left;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ Supabase</h1>
    
    <div class="test-section">
        <h2>1ï¸âƒ£ Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø©</h2>
        <div id="env-test">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</div>
    </div>

    <div class="test-section">
        <h2>2ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„</h2>
        <button onclick="testConnection()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„</button>
        <div id="connection-test"></div>
    </div>

    <div class="test-section">
        <h2>3ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>
        <button onclick="testStores()">Ø§Ø®ØªØ¨Ø§Ø± Stores</button>
        <button onclick="testProducts()">Ø§Ø®ØªØ¨Ø§Ø± Products</button>
        <button onclick="testSettings()">Ø§Ø®ØªØ¨Ø§Ø± Settings</button>
        <div id="data-test"></div>
    </div>

    <div class="test-section">
        <h2>4ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
        <input type="email" id="email" placeholder="Email" value="admin@makastore.com">
        <input type="password" id="password" placeholder="Password" value="Admin@123456">
        <button onclick="testLogin()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
        <div id="login-test"></div>
    </div>

    <script>
        // Ø§Ø³ØªØ¨Ø¯Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ù‚ÙŠÙ… Ø¨Ø§Ù„Ù‚ÙŠÙ… Ù…Ù† .env.local
        const SUPABASE_URL = 'https://ozlvlzmyceuefygvehmh.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im96bHZsem15Y2V1ZWZ5Z3ZlaG1oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc4NDc1MjEsImV4cCI6MjA4MzQyMzUyMX0.AYIM-xJLl9Qyj0a8C9_APvpCHA0f6oY0skvbvPGLoqQ';

        let supabaseClient;

        // Ø§Ø®ØªØ¨Ø§Ø± Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø©
        function testEnv() {
            const envDiv = document.getElementById('env-test');
            let html = '';

            if (SUPABASE_URL && SUPABASE_ANON_KEY) {
                html += '<p class="success">âœ… Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ù…ÙˆØ¬ÙˆØ¯Ø©</p>';
                html += `<pre>URL: ${SUPABASE_URL}</pre>`;
                html += `<pre>Key: ${SUPABASE_ANON_KEY.substring(0, 50)}...</pre>`;
                
                // Ø¥Ù†Ø´Ø§Ø¡ Supabase client
                supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                html += '<p class="success">âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Supabase client</p>';
            } else {
                html += '<p class="error">âŒ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©</p>';
            }

            envDiv.innerHTML = html;
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„
        async function testConnection() {
            const div = document.getElementById('connection-test');
            div.innerHTML = '<p>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...</p>';

            try {
                const { data, error } = await supabaseClient
                    .from('stores')
                    .select('count')
                    .limit(1);

                if (error) {
                    div.innerHTML = `<p class="error">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„:</p><pre>${JSON.stringify(error, null, 2)}</pre>`;
                } else {
                    div.innerHTML = '<p class="success">âœ… Ø§Ù„Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­!</p>';
                }
            } catch (err) {
                div.innerHTML = `<p class="error">âŒ Ø®Ø·Ø£:</p><pre>${err.message}</pre>`;
            }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Stores
        async function testStores() {
            const div = document.getElementById('data-test');
            div.innerHTML = '<p>Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Stores...</p>';

            try {
                const { data, error } = await supabaseClient
                    .from('stores')
                    .select('*')
                    .limit(5);

                if (error) {
                    div.innerHTML = `<p class="error">âŒ Ø®Ø·Ø£ ÙÙŠ Stores:</p><pre>${JSON.stringify(error, null, 2)}</pre>`;
                } else {
                    div.innerHTML = `<p class="success">âœ… Ù†Ø¬Ø­! Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ§Ø¬Ø±: ${data?.length || 0}</p><pre>${JSON.stringify(data, null, 2)}</pre>`;
                }
            } catch (err) {
                div.innerHTML = `<p class="error">âŒ Ø®Ø·Ø£:</p><pre>${err.message}</pre>`;
            }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Products
        async function testProducts() {
            const div = document.getElementById('data-test');
            div.innerHTML = '<p>Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Products...</p>';

            try {
                const { data, error } = await supabaseClient
                    .from('products')
                    .select('*')
                    .limit(5);

                if (error) {
                    div.innerHTML = `<p class="error">âŒ Ø®Ø·Ø£ ÙÙŠ Products:</p><pre>${JSON.stringify(error, null, 2)}</pre>`;
                } else {
                    div.innerHTML = `<p class="success">âœ… Ù†Ø¬Ø­! Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${data?.length || 0}</p><pre>${JSON.stringify(data, null, 2)}</pre>`;
                }
            } catch (err) {
                div.innerHTML = `<p class="error">âŒ Ø®Ø·Ø£:</p><pre>${err.message}</pre>`;
            }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Settings
        async function testSettings() {
            const div = document.getElementById('data-test');
            div.innerHTML = '<p>Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Settings...</p>';

            try {
                const { data: storeSettings, error: storeError } = await supabaseClient
                    .from('store_settings')
                    .select('*')
                    .limit(1)
                    .single();

                const { data: designSettings, error: designError } = await supabaseClient
                    .from('design_settings')
                    .select('*')
                    .limit(1)
                    .single();

                let html = '';

                if (storeError) {
                    html += `<p class="error">âŒ Ø®Ø·Ø£ ÙÙŠ Store Settings:</p><pre>${JSON.stringify(storeError, null, 2)}</pre>`;
                } else {
                    html += `<p class="success">âœ… Store Settings:</p><pre>${JSON.stringify(storeSettings, null, 2)}</pre>`;
                }

                if (designError) {
                    html += `<p class="error">âŒ Ø®Ø·Ø£ ÙÙŠ Design Settings:</p><pre>${JSON.stringify(designError, null, 2)}</pre>`;
                } else {
                    html += `<p class="success">âœ… Design Settings:</p><pre>${JSON.stringify(designSettings, null, 2)}</pre>`;
                }

                div.innerHTML = html;
            } catch (err) {
                div.innerHTML = `<p class="error">âŒ Ø®Ø·Ø£:</p><pre>${err.message}</pre>`;
            }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        async function testLogin() {
            const div = document.getElementById('login-test');
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            div.innerHTML = '<p>Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...</p>';

            try {
                const { data, error } = await supabaseClient.auth.signInWithPassword({
                    email,
                    password
                });

                if (error) {
                    div.innerHTML = `<p class="error">âŒ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:</p><pre>${JSON.stringify(error, null, 2)}</pre>`;
                } else {
                    div.innerHTML = `<p class="success">âœ… Ù†Ø¬Ø­ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„!</p><pre>${JSON.stringify(data, null, 2)}</pre>`;
                }
            } catch (err) {
                div.innerHTML = `<p class="error">âŒ Ø®Ø·Ø£:</p><pre>${err.message}</pre>`;
            }
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£ÙˆÙ„ÙŠ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.onload = testEnv;
    </script>
</body>
</html>
